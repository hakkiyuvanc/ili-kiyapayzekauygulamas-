"""
Professional Relationship Psychology Knowledge Base
Evidence-based insights for relationship analysis

Based on research from:
- John Gottman, Ph.D. - The Gottman Institute
- Sue Johnson, Ed.D. - Emotionally Focused Therapy
- Gary Chapman, Ph.D. - The 5 Love Languages
- Marshall Rosenberg, Ph.D. - Nonviolent Communication
"""

RELATIONSHIP_PSYCHOLOGY_KB = {
    "conflict_high": {
        "title": "Gottman'Ä±n 4 AtlÄ± Teorisi ve Ã‡atÄ±ÅŸma YÃ¶netimi",
        "source": "Gottman, J. M. (1994). What Predicts Divorce?",
        "content": """
**AraÅŸtÄ±rma Temeli:** 40 yÄ±llÄ±k longitudinal Ã§alÄ±ÅŸma, 3000+ Ã§ift Ã¼zerinde %90 doÄŸruluk oranÄ±.

**4 Tehlikeli Ä°letiÅŸim KalÄ±bÄ± ("Four Horsemen"):**

1. **ELEÅTÄ°RÄ° (Criticism)**
   - TanÄ±m: KiÅŸiliÄŸe saldÄ±rÄ±, karakter kusurlarÄ±na odaklanma
   - Ã–rnek: "Sen her zaman bÃ¶yle yapÄ±yorsun" â†’ DavranÄ±ÅŸa saldÄ±rÄ±
   - Antidot: "Ben-dili" kullanÄ±mÄ±
   - Uygulama: "Sen asla dinlemiyorsun" â†’ "DinlendiÄŸimi hissetmediÄŸimde Ã¼zÃ¼lÃ¼yorum"

2. **KÃœÃ‡ÃœMSEME (Contempt)**
   - En tehlikeli kalÄ±p (boÅŸanma riski 5.6x artÄ±rÄ±r)
   - Belirtiler: Ä°ÄŸneleyici ÅŸakalar, gÃ¶zlerini devirme, alaycÄ±lÄ±k, kÃ¼fÃ¼r
   - KÃ¶k neden: Ã‡Ã¶zÃ¼lmemiÅŸ kronik negativite
   - Antidot: KÃ¼ltÃ¼r oluÅŸturma - takdir ve saygÄ± pratiÄŸi

3. **SAVUNMAYA GEÃ‡ME (Defensiveness)**
   - Åikayetleri bahane ile karÅŸÄ±lama
   - Sorumluluk almayÄ± reddetme
   - KarÅŸÄ±-saldÄ±rÄ± yapma
   - Antidot: Sorumluluk kabul etme, "Sen haklÄ±sÄ±n" deme cesareti

4. **DUVARI Ã–RME (Stonewalling)**
   - Duygusal/fiziksel olarak geri Ã§ekilme (%85 erkeklerde)
   - GÃ¶z temasÄ±nÄ± kesme, donup kalma
   - Fizyolojik aÅŸÄ±rÄ± yÃ¼klenme (kalp atÄ±ÅŸÄ± >100)
   - Antidot: Fizyolojik sakinleÅŸme (20 dk mola), sonra dÃ¶nÃ¼ÅŸ

**OnarÄ±m GiriÅŸimleri (Repair Attempts):**
- Hafif ÅŸaka (alaycÄ± deÄŸil)
- Ã–zÃ¼r dileme
- Fiziksel temas
- Empati ifadeleri
- "Yeniden baÅŸlayabilir miyiz?" gibi meta-iletiÅŸim

**Kaynak:** Gottman, J. M., & Silver, N. (1999). The Seven Principles for Making Marriage Work.
""",
    },
    "empathy_low": {
        "title": "Empati ve Aktif Dinleme - BiliÅŸsel ve Duygusal Rezonans",
        "source": "Rogers, C. (1951). Client-Centered Therapy",
        "content": """
**Empati TÃ¼rleri:**

1. **BiliÅŸsel Empati:** Perspektif alma yeteneÄŸi
2. **Duygusal Empati:** Duygusal rezonans, hissetmek
3. **Empatik Ä°lgi:** YardÄ±m etme motivasyonu

**Aktif Dinleme Teknikleri (Rogers, 1951):**

1. **YANSITMA (Reflecting)**
   - SÃ¶ylenenleri kendi kelimeleriznle tekrarlama
   - "Demek istediÄŸin ÅŸu mu: ..."
   - DoÄŸruluk kontrolÃ¼ yapma

2. **DUYGU TANÄ±MA (Affect Labeling)**
   - Lieberman vd. (2007): Duyguyu adlandÄ±rma, limbik aktiviteyi azaltÄ±r
   - "ÃœzgÃ¼n/kÄ±zgÄ±n/hayal kÄ±rÄ±klÄ±ÄŸÄ±na uÄŸramÄ±ÅŸ gÃ¶rÃ¼nÃ¼yorsun"
   - Duygusal doÄŸrulama

3. **AÃ‡IKLAMA (Clarifying)**
   - Belirsiz noktalarda soru sorma
   - "Bunu biraz daha aÃ§abilir misin?"
   - VarsayÄ±mlardan kaÃ§Ä±nma

4. **Ã–ZETLEMEve (Summarizing)**
   - Periyodik olarak ana noktalarÄ± toplama
   - AnlaÅŸÄ±ldÄ±ÄŸÄ±nÄ± gÃ¶sterme

**Empati Engelleri:**
- Erken Ã§Ã¶zÃ¼m sunma ("Fix-it" sendromu)
- Ä°lgiyi kendine Ã§ekme ("Ben de ..." hikayesi)
- YargÄ±lama/deÄŸerlendirme
- Minimalize etme ("Abartma", "O kadar kÃ¶tÃ¼ deÄŸil")

**NÃ¶ro-Bilimsel Temel:**
- Ayna nÃ¶ronlar (Rizzolatti & Craighero, 2004)
- Anterior cingulate cortex aktivasyonu
- Oksitosin salÄ±nÄ±mÄ± â†’ baÄŸlanma

**Pratik: DoÄŸrulama DÃ¶ngÃ¼sÃ¼**
1. Dinle (kesintisiz)
2. YansÄ±t (anlayÄ±ÅŸÄ± kontrol et)
3. Duygu tanÄ± (hissettiklerini adlandÄ±r)
4. DoÄŸrula (duygularÄ±nÄ± meÅŸrulaÅŸtÄ±r)

**Kaynak:** Decety, J., & Jackson, P. L. (2004). The functional architecture of human empathy. Behavioral and Cognitive Neuroscience Reviews.
""",
    },
    "we_language_low": {
        "title": "Biz-Dili (Plural Pronouns) ve Ä°liÅŸki KimliÄŸi",
        "source": "Simmons vd. (2005). Journal of Social and Personal Relationships",
        "content": """
**AraÅŸtÄ±rma BulgularÄ±:**

**Simmons, Gordon & Chambless (2005):**
- "Biz/bizim" kullanÄ±mÄ±, iliÅŸki memnuniyeti ile pozitif korelasyon
- Problem Ã§Ã¶zme becerisini %30 artÄ±rÄ±r
- Stres altÄ±nda dayanÄ±klÄ±lÄ±k saÄŸlar

**Seider vd. (2009):**
- Ã‡atÄ±ÅŸma sÄ±rasÄ±nda "biz" dili â†’ daha etkili Ã§Ã¶zÃ¼m
- "Ben" dili â†’ bireysel Ã§Ä±kar odaÄŸÄ±, uzaklaÅŸma

**Neden Ã–nemli:**
- **Kimlik dÃ¶nÃ¼ÅŸÃ¼mÃ¼:** "Ben + Ben" â†’ "Biz"
- **Ortak hedefler:** PaylaÅŸÄ±lan vizyon
- **TakÄ±m zihniyeti:** Problemi birlikte sahiplenme
- **Duygusal gÃ¼ven:** "YalnÄ±z deÄŸilim" hissi

**Uygulama Stratejileri:**

1. **Dil DeÄŸiÅŸiklikleri:**
   - "Benim problemim" â†’ "Ãœzerinde Ã§alÄ±ÅŸmamÄ±z gereken bir durum"
   - "Sen yap" â†’ "Birlikte nasÄ±l yapabiliriz?"
   - "Ben istiyorum" â†’ "Bizim iÃ§in ne iyi olur?"

2. **Ortak RitÃ¼eller:**
   - HaftalÄ±k "Bizim" planÄ± (shared goals)
   - Ortak hobiler/aktiviteler
   - PaylaÅŸÄ±lan deÄŸerler Ã¼zerine konuÅŸmalar

3. **Karar Alma:**
   - Ã–nemli kararlarÄ± birlikte almak
   - "Ben karar verdim" â†’ "Birlikte karar verelim"
   - UzlaÅŸma kÃ¼ltÃ¼rÃ¼

4. **BaÅŸarÄ± KutlamalarÄ±:**
   - Bireyin baÅŸarÄ±sÄ± â†’ "Bizim baÅŸarÄ±mÄ±z"
   - TakÄ±m olarak kutlama

**Ä°liÅŸki KimliÄŸi Ã–lÃ§Ã¼mÃ¼ (Agnew vd., 1998):**
- Kendini nasÄ±l tanÄ±mlÄ±yorsun? [Ben---Biz spektrumu]
- YÃ¼ksek "biz" kimliÄŸi â†’ iliÅŸkiye yatÄ±rÄ±m, baÄŸlÄ±lÄ±k

**Dikkat:** SaÄŸlÄ±ksÄ±z "biz" (enmeshed) vs SaÄŸlÄ±klÄ± "biz" (differentiated)
- SaÄŸlÄ±klÄ±: BireyselliÄŸi korurken ortak kimlik
- SaÄŸlÄ±ksÄ±z: Bireysellik kaybÄ±, iÃ§ iÃ§e geÃ§me

**Kaynak:** Agnew, C. R., Van Lange, P. A., Rusbult, C. E., & Langston, C. A. (1998). Cognitive interdependence: Commitment and the mental representation of close relationships.
""",
    },
    "communication_balance_poor": {
        "title": "Ä°letiÅŸim Dengesi ve Turn-Taking Dinamikleri",
        "source": "Sacks, Schegloff & Jefferson (1974). Language in Social Interaction",
        "content": """
**KonuÅŸma Analizi (Conversation Analysis):**

**Ä°deal Denge:** 45-55% aralÄ±ÄŸÄ± (Sacks vd., 1974)
- Her iki taraf da sesini duyuruyor
- KarÅŸÄ±lÄ±klÄ± etki hissi
- GÃ¼Ã§ dengesi

**Dengesizlik Tipleri:**

1. **Dominant-Pasif DinamiÄŸi**
   - Bir taraf sÃ¼rekli konuÅŸuyor (>70%)
   - DiÄŸer taraf azÄ±nlÄ±kta (<30%)
   - GÃ¼Ã§ asimetrisi iÅŸareti

2. **Kesinti KalÄ±plarÄ±**
   - Kooperatif kesintiler (ilgi gÃ¶sterme)
   - Intrusive kesintiler (dominasyon)
   - Cinsiyet farklÄ±lÄ±klarÄ± (Tannen, 1990)

3. **Sessizlik KullanÄ±mÄ±**
   - Pasif-agresif sessizlik
   - DÃ¼ÅŸÃ¼nme iÃ§in sessizlik (saÄŸlÄ±klÄ±)

**DÃ¼zeltme Stratejileri:**

**1. YapÄ±landÄ±rÄ±lmÄ±ÅŸ Turnuslu KonuÅŸma:**
   - **KonuÅŸma SopasÄ± Metodu:**
     â€¢ SopayÄ± tutan konuÅŸur (kesintisiz)
     â€¢ Bitince sopayÄ± devreder
     â€¢ Fiziksel obje (yastÄ±k, top) kullan

**2. 10 Dakika KuralÄ± (Gottman):**
   - Her gÃ¼n 10 dk kesintisiz dinleme
   - Telefonlar kapalÄ±, TV kapalÄ±
   - Sadece dinle, Ã§Ã¶zÃ¼m sunma

**3. Speaker-Listener TekniÄŸi (PREP):**
   - Speaker: "Ben ..." ile baÅŸla, duygularÄ±nÄ± ifade et
   - Listener: YansÄ±t, doÄŸrula
   - Roller deÄŸiÅŸir
   - Ã‡atÄ±ÅŸma Ã§Ã¶zÃ¼mÃ¼nde etkili

**4. AÃ§Ä±k UÃ§lu Sorular:**
   - "NasÄ±ldÄ±?" â†’ "BugÃ¼n seni ne mutlu etti?"
   - "Ä°yi misin?" â†’ "Bu konuda nasÄ±l hissediyorsun?"
   - DerinleÅŸmeyi teÅŸvik eder

**Dinleme Kalitesi GÃ¶stergeleri:**
- GÃ¶z temasÄ± (kÃ¼ltÃ¼rel farklÄ±lÄ±klar dikkate alÄ±nmalÄ±)
- Beden dili (Ã¶ne eÄŸilme)
- Minimal teÅŸvikler ("hmm", "anlÄ±yorum")
- Parafraz etme
- Takip sorularÄ±

**AraÅŸtÄ±rma:** Driver & Gottman (2004) - GÃ¼nlÃ¼k etkileÅŸimlerde "Bid for attention"
- Bids: Ä°lgi Ã§ekme giriÅŸimleri
- Turning toward: Pozitif yanÄ±t (%86 mutlu Ã§iftler)
- Turning away: GÃ¶rmezden gelme (%33 mutsuz Ã§iftler)

**Kaynak:** Driver, J. L., & Gottman, J. M. (2004). Daily marital interactions and positive affect during marital conflict among newlywed couples.
""",
    },
    "sentiment_negative": {
        "title": "Negatif Duygu RegÃ¼lasyonu ve Emotional Flooding",
        "source": "Gottman, J. M. (1999). The Marriage Clinic",
        "content": """
**Duygusal Sel BasmasÄ± (Emotional Flooding):**

**TanÄ±m:** AÅŸÄ±rÄ± negatif duygularÄ±n kiÅŸiyi ele geÃ§irmesi
- Kalp atÄ±ÅŸÄ± >100 bpm
- Kortizol artÄ±ÅŸÄ±
- Prefrontal cortex deaktivasyonu
- "SavaÅŸ ya da kaÃ§" modu

**Gottman'Ä±n 5:1 OranÄ± (Magic Ratio):**
- **Her 1 negatif etkileÅŸim iÃ§in 5 pozitif etkileÅŸim gerekli**
- Mutlu Ã§iftler: 5:1 veya daha yÃ¼ksek
- BoÅŸanan Ã§iftler: 0.8:1 (daha fazla negatif!)

**Duygu RegÃ¼lasyon Stratejileri (Gross, 2002):**

1. **Durum SeÃ§imi (Situation Selection)**
   - Tetikleyici durumlardan kaÃ§Ä±nma
   - Ã–rnek: Yorgunken kritik konularÄ± tartÄ±ÅŸmama

2. **Durum Modifikasyonu (Situation Modification)**
   - OrtamÄ± deÄŸiÅŸtirme
   - Ã–rnek: GÃ¼rÃ¼ltÃ¼lÃ¼ ortamda konuÅŸmak yerine sakin yer

3. **Dikkat DaÄŸÄ±tma (Attentional Deployment)**
   - OdaÄŸÄ± deÄŸiÅŸtirme
   - Mindfulness teknikleri

4. **BiliÅŸsel Yeniden DeÄŸerlendirme (Cognitive Reappraisal)**
   - Duruma farklÄ± anlam yÃ¼kleme
   - "Beni incitmek istedi" â†’ "Stresli olduÄŸu iÃ§in bÃ¶yle davrandÄ±"

5. **YanÄ±t ModÃ¼lasyonu (Response Modulation)**
   - Duygusal ifadeyi kontrol etme
   - Derin nefes, progressive muscle relaxation

**Fizyolojik SakinleÅŸme (Physiological Soothing):**
- **20 Dakika KuralÄ±:** Flooding durumunda 20 dk mola
- Aktiviteler: YÃ¼rÃ¼yÃ¼ÅŸ, mÃ¼zik dinleme, nefes egzersizleri
- Ã–nemli: Partner suÃ§lama dÃ¼ÅŸÃ¼ncelerinden kaÃ§Ä±n

**OnarÄ±m ve Ä°yileÅŸme:**

**Ã–zÃ¼r Dileme (Lazare, 2004):**
1. Kabullenme: "YanlÄ±ÅŸ yaptÄ±m"
2. AÃ§Ä±klama (bahane deÄŸil): "Stresliydim ama bu bahaneyideÄŸil"
3. PiÅŸmanlÄ±k: "Ã‡ok Ã¼zgÃ¼nÃ¼m"
4. Telafi: "NasÄ±l dÃ¼zeltebilirim?"
5. Gelecek taahhÃ¼dÃ¼: "Bir daha yapmayacaÄŸÄ±m"

**Kurtarma GiriÅŸimleri:**
- Espri (agresif deÄŸil, hafif)
- Fiziksel yakÄ±nlÄ±k (el tutma)
- "Time-out" isteme
- "Yeniden baÅŸlayalÄ±m mÄ±?"

**Pozitif Duygu Ä°nÅŸasÄ±:**
- GÃ¼nlÃ¼k takdir pratiÄŸi (3 ÅŸey)
- KÃ¼Ã§Ã¼k sÃ¼rprizler
- Birlikte gÃ¼lme, eÄŸlenme
- Ortak pozitif anÄ±lar yaratma

**Kaynak:** Gottman, J. M., & Levenson, R. W. (1992). Marital processes predictive of later dissolution: Behavior, physiology, and health.
""",
    },
    "attachment_patterns": {
        "title": "BaÄŸlanma Teorisi ve Ä°liÅŸki Dinamikleri",
        "source": "Bowlby, J. (1982). Attachment and Loss",
        "content": """
**YetiÅŸkin BaÄŸlanma Stilleri (Hazan & Shaver, 1987):**

1. **GÃ¼venli BaÄŸlanma (Secure) - ~50%**
   - Ã–zellikler: YakÄ±nlÄ±ktan rahatsÄ±z olmama, gÃ¼ven
   - Ä°liÅŸkide: AÃ§Ä±k iletiÅŸim, duygusal eriÅŸilebilirlik
   - Ã‡ocukluk: Ä°stikrarlÄ±, duyarlÄ± bakÄ±m veren

2. **KaygÄ±lÄ± BaÄŸlanma (Anxious-Preoccupied) - ~20%**
   - Ã–zellikler: Terk edilme korkusu, onay arayÄ±ÅŸÄ±
   - Ä°liÅŸkide: AÅŸÄ±rÄ± ihtiyaÃ§lÄ±lÄ±k, kÄ±skanÃ§lÄ±k
   - Ã‡ocukluk: TutarsÄ±z bakÄ±m veren

3. **KaÃ§Ä±ngan BaÄŸlanma (Dismissive-Avoidant) - ~25%**
   - Ã–zellikler: BaÄŸÄ±msÄ±zlÄ±k vurgusu, yakÄ±nlÄ±ktan kaÃ§Ä±nma
   - Ä°liÅŸkide: Duygusal mesafe, "Sana ihtiyacÄ±m yok"
   - Ã‡ocukluk: Ä°hmal veya reddedici bakÄ±m veren

4. **Korkulu-KaÃ§Ä±ngan (Fearful-Avoidant) - ~5%**
   - Ã–zellikler: YakÄ±nlÄ±k hem arzulanÄ±r hem korkutur
   - Ä°liÅŸkide: Kaos, gÃ¼vensizlik
   - Ã‡ocukluk: Travmatik iliÅŸkiler

**Protest DÃ¶ngÃ¼sÃ¼ (Sue Johnson, EFT):**
1. KiÅŸi A â†’ Duygusal ihtiyaÃ§ (baÄŸlanma)
2. KiÅŸi B â†’ Kapanma, uzaklaÅŸma (kaÃ§Ä±nma)
3. KiÅŸi A â†’ ArtmÄ±ÅŸ kÄ±zgÄ±nlÄ±k, protest (kaygÄ±lÄ±)
4. KiÅŸi B â†’ Daha fazla Ã§ekilme
â†’ Negatif dÃ¶ngÃ¼

**Ä°yileÅŸme (EFT YaklaÅŸÄ±mÄ±):**
- **Tango Metaforu:** Her ikisi de adÄ±m Ã¶ÄŸrenmeli
- Duygusal ihtiyaÃ§larÄ± tanÄ±ma ve ifade etme
- SavunmasÄ±zlÄ±ÄŸÄ± paylaÅŸma
- GÃ¼venli liman yaratma

**Kaynak:** Johnson, S. M. (2004). The Practice of Emotionally Focused Couple Therapy: Creating Connection.
""",
    },
    "general_strength": {
        "title": "Ä°liÅŸki Direnci ve Pozitif Psikoloji YaklaÅŸÄ±mÄ±",
        "source": "Gottman, J. M. (1999). The Seven Principles",
        "content": """
**7 Temel Prensip (Gottman's Sound Relationship House):**

1. **SEVG Ä° HARÄ°TALARI (Love Maps)**
   - Partnerinizi tanÄ±yÄ±n: Hayaller, korkular, deÄŸerler
   - Soru Ã¶rnekleri: "En bÃ¼yÃ¼k rÃ¼yan ne?", "En kÃ¶tÃ¼ korkunuz?"
   - SÃ¼rekli gÃ¼ncelleyin (insanlar deÄŸiÅŸir)

2. **SEVGÄ° VE HAYRANLIK (Fondness & Admiration)**
   - Pozitif Ã¶zellikleri tanÄ±ma ve ifade etme
   - Antidote to contempt
   - GÃ¼nlÃ¼k: "Sende sevdiÄŸim bir ÅŸey..."

3. **BÄ°RBÄ°RÄ°NE YÃ–NELÄ°M (Turn Toward)**
   - KÃ¼Ã§Ã¼k ilgi Ã§ekme giriÅŸimlerine (bids) yanÄ±t
   - %86 mutlu Ã§iftlerde turning toward
   - Ã–rnek: "Åuna bak!" â†’ "Ä°lginÃ§miÅŸ!" (turn toward)

4. **POZÄ°TÄ°F PERSPEKTÄ°F (Positive Perspective)**
   - Ä°yi niyet varsayÄ±mÄ±
   - SorunlarÄ± geÃ§ici gÃ¶rme
   - OlumsuzluÄŸu minimize etme (sÄ±nÄ±ra kadar)

5. **Ã‡ATIÅMA YÃ–NETÄ°MÄ° (Manage Conflict)**
   - %69 sorunlar Ã§Ã¶zÃ¼lemez! (Perpetual problems)
   - Diyalog kurma, Ã§Ã¶zmek zorunda deÄŸilsin
   - Gridlock'tan dialogue'a geÃ§iÅŸ

6. **HAYALLER Ä° DESTEKLEME (Make Life Dreams Come True)**
   - Partnerinizin hayallerini Ã¶ÄŸrenin
   - Engel olmayÄ±n, destekleyin
   - PaylaÅŸÄ±lan hedefler oluÅŸturun

7. **ORTAK ANLAM (Create Shared Meaning)**
   - PaylaÅŸÄ±lan deÄŸerler, ritÃ¼eller, semboller
   - Ortak hikaye: "Biz" kimliÄŸi
   - Aile kÃ¼ltÃ¼rÃ¼ yaratma

**Pozitif Ä°liÅŸki Pratikileri:**

**GÃ¼nlÃ¼k RitÃ¼eller:**
- 6-saniyelik Ã¶pÃ¼cÃ¼k (oksit osin salÄ±nÄ±mÄ±)
- AyrÄ±lÄ±rken vedalaÅŸma (2 dk)
- BuluÅŸma ritÃ¼eli (telefonlar kapalÄ± 20 dk)
- Yatmadan "TeÅŸekkÃ¼rler" ve "Ã–zÃ¼r"

**HaftalÄ±k:**
- Date night (aktivite veya derin konuÅŸma)
- Ä°liÅŸki durum deÄŸerlendirmesi

**Kaynaklar:**
- Gottman, J. M., & Silver, N. (2015). The Seven Principles for Making Marriage Work.
- Chapman, G. (2015). The 5 Love Languages.
- Johnson, S. (2008). Hold Me Tight.
""",
    },
}


def get_relevant_knowledge(metrics: dict) -> list:
    """
    Select relevant psychology knowledge based on metrics

    Uses evidence-based selection criteria to match relationship patterns
    with appropriate psychological frameworks.

    Args:
        metrics: Dict containing analysis metrics (sentiment, empathy, conflict, etc.)

    Returns:
        List of knowledge snippets (max 3 for prompt efficiency)
    """
    knowledge = []

    # High conflict â†’ Gottman's Four Horsemen
    if metrics.get("conflict", {}).get("score", 0) > 60:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["conflict_high"])

    # Low empathy â†’ Active listening & empathy skills
    if metrics.get("empathy", {}).get("score", 100) < 50:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["empathy_low"])

    # Low we-language â†’ Plural pronouns & relationship identity
    if metrics.get("we_language", {}).get("score", 100) < 40:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["we_language_low"])

    # Poor communication balance â†’ Turn-taking dynamics
    balance_score = metrics.get("communication_balance", {}).get("score", 50)
    if balance_score < 40 or balance_score > 60:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["communication_balance_poor"])

    # Negative sentiment â†’ Emotion regulation
    if metrics.get("sentiment", {}).get("score", 50) < 40:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["sentiment_negative"])

    # Add attachment or general strength as baseline (if space)
    if len(knowledge) == 0:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["general_strength"])
    elif len(knowledge) < 2:
        knowledge.append(RELATIONSHIP_PSYCHOLOGY_KB["attachment_patterns"])

    # Limit to 3 snippets (prevent prompt bloat, optimize token usage)
    return knowledge[:3]


def format_knowledge_context(knowledge_list: list) -> str:
    """
    Format knowledge snippets for prompt injection

    Creates a structured context section with academic references
    that enhances AI responses with evidence-based psychological knowledge.

    Args:
        knowledge_list: List of knowledge dictionaries

    Returns:
        Formatted context string with citations
    """
    if not knowledge_list:
        return ""

    context = "\n\nğŸ“š UZMAN BÄ°LGÄ° KAYNAKLARI (Evidence-Based Psychology):\n\n"

    for i, kb in enumerate(knowledge_list, 1):
        context += f"â•â•â• [{i}] {kb['title']} â•â•â•\n"
        context += f"ğŸ“– Kaynak: {kb['source']}\n\n"
        context += kb["content"].strip()
        context += "\n\n"

    context += "ğŸ’¡ TaliMAT: YukarÄ±daki bilimsel kaynaklardaki bilgileri kullanarak "
    context += "kanÄ±ta dayalÄ±, profesyonel iÃ§gÃ¶rÃ¼ler Ã¼ret. Spesifik tekniklere ve "
    context += "araÅŸtÄ±rmalara referans ver.\n"
    context += "â•" * 50 + "\n\n"

    return context
